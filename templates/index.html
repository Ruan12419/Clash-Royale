<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clash Royale Balanceamento</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div id="app" class="container mt-5">
        <h1>Clash Royale - Dados de Cartas e Estatísticas</h1>

        <button class="btn btn-primary mb-3" @click="insertCards">Adicionar Cartas</button>
        <button class="btn btn-primary mb-3" @click="fetchCards">Atualizar Cartas</button>
        <button class="btn btn-warning mb-3" @click="fetchMostUsedCards">Cartas Mais Usadas</button>

        <h2>Adicionar Informações do Jogador</h2>

        <input type="text" v-model="playerTag" placeholder="TAG do Jogador" class="form-control mb-3">
        <button class="btn btn-primary mb-3" @click="fetchPlayer">Adicionar Jogador</button>
        <button class="btn btn-info mb-3" v-model="playerTag" @click="fetchPlayerStats">Buscar Estatísticas do
            Jogador</button>
        <button class="btn btn-secondary mb-3" v-model="playerTag" @click="fetchBattles">Atualizar Batalhas</button>

        <h2>Estatísticas do Jogador</h2>
        <div v-if="playerStats">
            <p><strong>Vitórias:</strong> {{ playerStats.wins }}</p>
            <p><strong>Derrotas:</strong> {{ playerStats.losses }}</p>
            <p><strong>Batalhas Totais:</strong> {{ playerStats.battleCount }}</p>
        </div>

        <h2>Cartas Mais Usadas</h2>
        <ul v-if="mostUsedCards.length > 0">
            <li v-for="card in mostUsedCards" :key="card._id">{{ card._id }} - Usado em {{ card.count }} batalhas</li>
        </ul>

        <h2>Filtrar por Intervalo de Tempo</h2>

        <label for="startTime">Data de Início:</label>
        <input type="datetime-local" v-model="startTime" class="form-control mb-3">

        <label for="endTime">Data de Fim:</label>
        <input type="datetime-local" v-model="endTime" class="form-control mb-3">

        <h2>Buscar Decks por Taxa de Vitórias</h2>
        <label for="percentage">Porcentagem mínima de vitórias:</label>
        <input type="number" v-model="percentage" id="percentage" />
        <button @click="getDecks">Buscar Decks</button>
        <table v-if="decks.length > 0" class="table table-bordered">
            <thead>
                <tr>
                    <th>Deck</th>
                    <th>Total de Batalhas</th>
                    <th>Vitórias</th>
                    <th>Taxa de Vitórias (%)</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="deck in decks" :key="deck._id">
                    <td>{{ deck._id.join(', ') }}</td>
                    <td>{{ deck.total_battles }}</td>
                    <td>{{ deck.wins }}</td>
                    <td>{{ deck.win_rate.toFixed(2) }}%</td>
                </tr>
            </tbody>
        </table>
        <p v-else>Nenhum deck encontrado.</p>

        <h2 @click="toggleDropdown" style="cursor: pointer; color: blue">
            Número de Derrotas de Deck:
        </h2>
        <div v-if="isDropdownVisible">
            <div>
                <label for="combo">Combo de Cartas:</label>
                <div v-for="card in cards" :key="card.name" class="form-check">
                    <input type="checkbox" :id="card.name" :value="card.name" v-model="combo" class="form-check-input">
                    <label :for="card.name" class="form-check-label">{{ card.name }}</label>
                </div>
            </div>

            <button class="btn btn-primary mb-3" @click="getLosses">Buscar Derrotas</button>

            <div v-if="losses > -1">
                <h3>Quantidade de derrotas: {{ losses }}</h3>
            </div>
        </div>

        <h2 @click="toggleWinsSection" style="cursor: pointer; color: blue">Número de Vitórias com Condições</h2>
        <div v-show="showWinsSection">
            <div>
                <label for="card_name">Nome da Carta:</label>
                <input type="text" v-model="cardName" id="card_name" placeholder="Nome da Carta">
            </div>
            <div>
                <label for="trophy_percentage">Porcentagem de Diferença de Troféus:</label>
                <input type="number" v-model="trophyPercentageDifference" id="trophy_percentage" placeholder="Z%">
            </div>

            <button @click="getWinsWithConditions">Buscar Vitórias</button>

            <div v-if="wins.length > 0">
                <h3>Vitórias encontradas:</h3>
                <ul>
                    <li v-for="win in wins" :key="win._id">
                        {{ win.card_name }}: {{ win.wins }} vitórias
                    </li>
                </ul>
            </div>
        </div>


        <h2>Pesquisar e Ordenar Cartas</h2>

        <input type="text" v-model="searchQuery" placeholder="Pesquisar carta por nome..." class="form-control mb-3">

        <select v-model="sortOption" class="form-control mb-3">
            <option value="none">Sem Ordenação</option>
            <option value="winRateAsc">Ordenar por Menor Taxa de Vitória</option>
            <option value="winRateDesc">Ordenar por Maior Taxa de Vitória</option>
        </select>

        <h2>Cartas</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Elixir</th>
                    <th>Raridade</th>
                    <th>Icon</th>
                    <th>Taxa de Vitória</th>
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="card in paginatedCards" :key="card.name">
                    <td>{{ card.name }}</td>
                    <td>{{ card.elixirCost }}</td>
                    <td>{{ card.rarity }}</td>
                    <td>
                        <img :src="card.iconUrls.medium" height="80" width="80" />
                    </td>
                    <td>{{ winRates[card.name] !== undefined ? `${(winRates[card.name] * 1).toFixed(2)}%` : "Sem dados"
                        }}</td>
                    <td>
                        <button @click="fetchCardWinRateInTimeRange(card.name)" class="btn btn-info">Ver Taxa de Vitória
                            no Intervalo</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination">
            <button @click="prevPage" :disabled="currentPage === 1" class="btn btn-secondary">Anterior</button>
            <span>Página {{ currentPage }} de {{ totalPages }}</span>
            <button @click="nextPage" :disabled="currentPage === totalPages" class="btn btn-secondary">Próxima</button>
        </div>
        <h2>Combo de Cartas com Alta Taxa de Vitórias</h2>
         <label for="comboSize">Tamanho do Combo (N):</label>
         <input type="number" v-model="comboSize" class="form-control mb-3">
 
         <label for="winRate">Porcentagem mínima de vitórias (Y%):</label>
         <input type="number" v-model="winRate" class="form-control mb-3">
 
         <label for="startTime">Data de Início:</label>
         <input type="datetime-local" v-model="startTime" class="form-control mb-3">
 
         <label for="endTime">Data de Fim:</label>
         <input type="datetime-local" v-model="endTime" class="form-control mb-3">
 
         <button class="btn btn-info mb-3" @click="fetchCardCombos">Buscar Combos</button>
 
         <div v-if="cardCombos.length > 0">
             <h3>Combos encontrados:</h3>
             <ul>
                 <li v-for="combo in cardCombos" :key="combo._id">{{ combo.cards.join(', ') }} - {{ combo.winRate }}% vitórias</li>
             </ul>
         </div>
 
         <h2>Cartas com Maior Taxa de Derrota</h2>
         <label for="defeatComboSize">Tamanho da Combinação:</label>
         <input type="number" v-model="defeatComboSize" class="form-control mb-3">
 
         <button class="btn btn-danger mb-3" @click="fetchHighDefeatCards">Buscar Combinações com Alta Taxa de Derrota</button>
 
         <div v-if="highDefeatCards.length > 0">
             <h3>Combinações com Alta Taxa de Derrota:</h3>
             <ul>
                 <li v-for="combo in highDefeatCards" :key="combo._id">{{ combo.cards.join(', ') }} - {{ combo.defeatRate }}% derrotas</li>
             </ul>
         </div>
 
         <h2>Desempenho de Cartas Contra Oponentes Específicos</h2>
         <label for="opponentType">Tipo de Oponente (ex: aéreo, defensivo):</label>
         <input type="text" v-model="opponentType" class="form-control mb-3">
 
         <button class="btn btn-secondary mb-3" @click="fetchCardPerformance">Buscar Desempenho</button>
 
         <div v-if="cardPerformance.length > 0">
             <h3>Desempenho das Cartas:</h3>
             <ul>
                 <li v-for="performance in cardPerformance" :key="performance._id">
                     {{ performance.cards.join(', ') }} - {{ performance.performanceRate }}% contra {{ opponentType }}
                 </li>
             </ul>
         </div>
 
         <h2>Trending Cards (Taxa de Utilização ao Longo do Tempo)</h2>
         <label for="trendStartTime">Data de Início:</label>
         <input type="datetime-local" v-model="trendStartTime" class="form-control mb-3">
 
         <label for="trendEndTime">Data de Fim:</label>
         <input type="datetime-local" v-model="trendEndTime" class="form-control mb-3">
 
         <button class="btn btn-success mb-3" @click="fetchTrendingCards">Buscar Cartas Tendência</button>
 
         <div v-if="trendingCards.length > 0">
             <h3>Cartas em Tendência:</h3>
             <ul>
                 <li v-for="card in trendingCards" :key="card._id">{{ card.name }} - Taxa de Utilização: {{ card.usageRate }}%</li>
             </ul>
         </div> 
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>
